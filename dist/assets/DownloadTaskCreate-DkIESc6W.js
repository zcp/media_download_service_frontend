import{aB as q,r as I,X as E,al as m,y as M,z as B,Q as r,I as a,V as T,A as u,M as v,u as z}from"./vue-CG64YRnT.js";import{a as H}from"./index-DpMErgrC.js";import{g as $,E as f}from"./elementPlus-Djpklj9S.js";import{_ as j}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-Dq7h7Pqt.js";const d=[];for(let o=0;o<256;++o)d.push((o+256).toString(16).slice(1));function N(o,t=0){return(d[o[t+0]]+d[o[t+1]]+d[o[t+2]]+d[o[t+3]]+"-"+d[o[t+4]]+d[o[t+5]]+"-"+d[o[t+6]]+d[o[t+7]]+"-"+d[o[t+8]]+d[o[t+9]]+"-"+d[o[t+10]]+d[o[t+11]]+d[o[t+12]]+d[o[t+13]]+d[o[t+14]]+d[o[t+15]]).toLowerCase()}let y;const P=new Uint8Array(16);function A(){if(!y){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");y=crypto.getRandomValues.bind(crypto)}return y(P)}const F=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),D={randomUUID:F};function O(o,t,w){var _;if(D.randomUUID&&!o)return D.randomUUID();o=o||{};const i=o.random??((_=o.rng)==null?void 0:_.call(o))??A();if(i.length<16)throw new Error("Random bytes length must be >= 16");return i[6]=i[6]&15|64,i[8]=i[8]&63|128,N(i)}const Q={class:"task-create-page"},X={class:"card-header"},G={class:"form-section"},J={class:"form-section"},K={class:"form-actions"},W={__name:"DownloadTaskCreate",setup(o){const t=q(),w=H(),i=I(),_=I(!1),l=E({resource_url:"",resource_type:"",video_id:"",liveroom_id:"",liveroom_title:"",liveroom_url:""}),h={resource_url:[{required:!0,message:"请输入资源URL",trigger:"blur"},{pattern:/^https?:\/\/.+/,message:"请输入有效的URL格式",trigger:"blur"}],resource_type:[{required:!0,message:"请选择资源类型",trigger:"change"}],video_id:[{required:!0,message:"请输入视频ID",trigger:"blur"},{pattern:/^.+_.+$/,message:"格式要求：{liveroom_id}_{uuid4后缀}",trigger:"blur"}],liveroom_id:[{required:!0,message:"请输入直播间ID",trigger:"blur"}],liveroom_url:[{pattern:/^(https?:\/\/.+)?$/,message:"请输入有效的URL格式",trigger:"blur"}]},V=()=>{if(!l.liveroom_id){f.warning("请先输入直播间ID");return}const n=O();l.video_id=`${l.liveroom_id}_${n}`,f.success("视频ID生成成功")},x=()=>{(!l.video_id||l.video_id.includes("_"))&&V()},U=async()=>{if(i.value)try{await i.value.validate(),_.value=!0;const n={...l};await w.createTask(n),f.success("任务创建成功"),t.push("/download-center/tasks")}catch(n){n.errors?console.log("表单验证失败:",n):(console.error("创建任务失败:",n),f.error("创建任务失败，请重试"))}finally{_.value=!1}},k=()=>{i.value&&i.value.resetFields(),Object.keys(l).forEach(n=>{l[n]=""})},R=()=>{t.back()};return(n,e)=>{const g=m("el-button"),c=m("el-input"),p=m("el-form-item"),b=m("el-option"),L=m("el-select"),C=m("el-form"),S=m("el-card");return B(),M("div",Q,[r(S,{class:"create-card",shadow:"never"},{header:a(()=>[u("div",X,[e[7]||(e[7]=u("h2",{class:"page-title"},"创建下载任务",-1)),r(g,{onClick:R,icon:z($)},{default:a(()=>e[6]||(e[6]=[v("返回列表")])),_:1,__:[6]},8,["icon"])])]),default:a(()=>[r(C,{ref_key:"formRef",ref:i,model:l,rules:h,"label-width":"120px",size:"large",onSubmit:T(U,["prevent"])},{default:a(()=>[u("div",G,[e[11]||(e[11]=u("h3",{class:"section-title"},"基本信息",-1)),r(p,{label:"资源URL",prop:"resource_url",required:""},{default:a(()=>[r(c,{modelValue:l.resource_url,"onUpdate:modelValue":e[0]||(e[0]=s=>l.resource_url=s),type:"textarea",rows:3,placeholder:"请输入资源URL（支持HLS、MP4、图片等格式）","show-word-limit":"",maxlength:"2000"},null,8,["modelValue"]),e[8]||(e[8]=u("div",{class:"form-tip"}," 支持的格式：HLS (.m3u8)、MP4 (.mp4)、图片 (.jpg, .png, .gif) ",-1))]),_:1,__:[8]}),r(p,{label:"资源类型",prop:"resource_type",required:""},{default:a(()=>[r(L,{modelValue:l.resource_type,"onUpdate:modelValue":e[1]||(e[1]=s=>l.resource_type=s),placeholder:"选择资源类型"},{default:a(()=>[r(b,{label:"HLS",value:"hls"}),r(b,{label:"MP4",value:"mp4"}),r(b,{label:"图片",value:"image"})]),_:1},8,["modelValue"])]),_:1}),r(p,{label:"视频ID",prop:"video_id",required:""},{default:a(()=>[r(c,{modelValue:l.video_id,"onUpdate:modelValue":e[2]||(e[2]=s=>l.video_id=s),placeholder:"格式：{liveroom_id}_{uuid4后缀}","show-word-limit":"",maxlength:"100"},{append:a(()=>[r(g,{onClick:V,disabled:!l.liveroom_id},{default:a(()=>e[9]||(e[9]=[v(" 自动生成 ")])),_:1,__:[9]},8,["disabled"])]),_:1},8,["modelValue"]),e[10]||(e[10]=u("div",{class:"form-tip"}," 格式要求：{直播间ID}_{UUID4后缀}，例如：room123_a1b2c3d4-e5f6-7890-abcd-ef1234567890 ",-1))]),_:1,__:[10]}),r(p,{label:"直播间ID",prop:"liveroom_id",required:""},{default:a(()=>[r(c,{modelValue:l.liveroom_id,"onUpdate:modelValue":e[3]||(e[3]=s=>l.liveroom_id=s),placeholder:"请输入直播间ID",onInput:x},null,8,["modelValue"])]),_:1})]),u("div",J,[e[12]||(e[12]=u("h3",{class:"section-title"},"可选信息",-1)),r(p,{label:"直播间标题",prop:"liveroom_title"},{default:a(()=>[r(c,{modelValue:l.liveroom_title,"onUpdate:modelValue":e[4]||(e[4]=s=>l.liveroom_title=s),placeholder:"请输入直播间标题（可选）","show-word-limit":"",maxlength:"200"},null,8,["modelValue"])]),_:1}),r(p,{label:"直播间URL",prop:"liveroom_url"},{default:a(()=>[r(c,{modelValue:l.liveroom_url,"onUpdate:modelValue":e[5]||(e[5]=s=>l.liveroom_url=s),placeholder:"请输入直播间URL（可选）","show-word-limit":"",maxlength:"500"},null,8,["modelValue"])]),_:1})]),u("div",K,[r(g,{size:"large",onClick:k},{default:a(()=>e[13]||(e[13]=[v("重置")])),_:1,__:[13]}),r(g,{type:"primary",size:"large",onClick:U,loading:_.value},{default:a(()=>e[14]||(e[14]=[v(" 创建任务 ")])),_:1,__:[14]},8,["loading"])])]),_:1},8,["model"])]),_:1})])}}},re=j(W,[["__scopeId","data-v-d768884f"]]);export{re as default};

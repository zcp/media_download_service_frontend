import{aB as M,r as h,X as B,h as T,al as m,y as j,z,Q as t,I as a,V as H,A as u,M as b,u as N}from"./vue-CG64YRnT.js";import{a as P}from"./index-CYcOiW0B.js";import{g as A,E as g}from"./elementPlus-Djpklj9S.js";import{_ as O}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-Dq7h7Pqt.js";const i=[];for(let o=0;o<256;++o)i.push((o+256).toString(16).slice(1));function F(o,r=0){return(i[o[r+0]]+i[o[r+1]]+i[o[r+2]]+i[o[r+3]]+"-"+i[o[r+4]]+i[o[r+5]]+"-"+i[o[r+6]]+i[o[r+7]]+"-"+i[o[r+8]]+i[o[r+9]]+"-"+i[o[r+10]]+i[o[r+11]]+i[o[r+12]]+i[o[r+13]]+i[o[r+14]]+i[o[r+15]]).toLowerCase()}let y;const G=new Uint8Array(16);function Q(){if(!y){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");y=crypto.getRandomValues.bind(crypto)}return y(G)}const X=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),I={randomUUID:X};function V(o,r,w){var p;if(I.randomUUID&&!o)return I.randomUUID();o=o||{};const s=o.random??((p=o.rng)==null?void 0:p.call(o))??Q();if(s.length<16)throw new Error("Random bytes length must be >= 16");return s[6]=s[6]&15|64,s[8]=s[8]&63|128,F(s)}const $={class:"task-create-page"},J={class:"card-header"},K={class:"form-section"},W={class:"form-section"},Y={class:"form-actions"},Z={__name:"DownloadTaskCreate",setup(o){const r=M(),w=P(),s=h(),p=h(!1),l=B({resource_url:"",resource_type:"",video_id:"",liveroom_id:"",liveroom_title:"",liveroom_url:""}),R={resource_url:[{required:!0,message:"请输入资源URL",trigger:"blur"},{pattern:/^https?:\/\/.+/,message:"请输入有效的URL格式",trigger:"blur"}],resource_type:[{required:!0,message:"请选择资源类型",trigger:"change"}],video_id:[{required:!1,message:"视频ID不能为空",trigger:"blur"}],liveroom_id:[{required:!0,message:"请输入直播间ID",trigger:"blur"}],liveroom_title:[{required:!0,message:"请输入直播间标题",trigger:"blur"}],liveroom_url:[{required:!0,message:"请输入直播间URL",trigger:"blur"},{pattern:/^(https?:\/\/.+)?$/,message:"请输入有效的URL格式",trigger:"blur"}]},x=()=>{if(!l.liveroom_id){g.warning("请先输入直播间ID");return}const n=V();l.video_id=n,g.success("视频ID生成成功")},D=()=>{l.video_id=V()},k=()=>{l.liveroom_id&&!l.video_id&&x()};T(()=>{l.video_id||(l.video_id=V()),l.liveroom_id&&k()});const U=async()=>{if(s.value)try{await s.value.validate(),p.value=!0;const n={...l};console.log("提交的表单数据:",n),Object.keys(n).forEach(e=>{(n[e]===void 0||n[e]===null)&&(n[e]="")}),console.log("清理后的表单数据:",n),await w.createTask(n),g.success("任务创建成功"),r.push("/download-center/tasks")}catch(n){n.errors?console.log("表单验证失败:",n):(console.error("创建任务失败:",n),g.error("创建任务失败，请重试"))}finally{p.value=!1}},L=()=>{s.value&&s.value.resetFields(),Object.keys(l).forEach(n=>{l[n]=""})},q=()=>{r.back()};return(n,e)=>{const v=m("el-button"),c=m("el-input"),_=m("el-form-item"),f=m("el-option"),S=m("el-select"),C=m("el-form"),E=m("el-card");return z(),j("div",$,[t(E,{class:"create-card",shadow:"never"},{header:a(()=>[u("div",J,[e[7]||(e[7]=u("h2",{class:"page-title"},"创建下载任务",-1)),t(v,{onClick:q,icon:N(A)},{default:a(()=>e[6]||(e[6]=[b("返回列表")])),_:1,__:[6]},8,["icon"])])]),default:a(()=>[t(C,{ref_key:"formRef",ref:s,model:l,rules:R,"label-width":"120px",size:"large",onSubmit:H(U,["prevent"])},{default:a(()=>[u("div",K,[e[9]||(e[9]=u("h3",{class:"section-title"},"基本信息",-1)),t(_,{label:"资源URL",prop:"resource_url",required:""},{default:a(()=>[t(c,{modelValue:l.resource_url,"onUpdate:modelValue":e[0]||(e[0]=d=>l.resource_url=d),type:"textarea",rows:3,placeholder:"请输入资源URL（支持HLS、MP4、图片等格式）","show-word-limit":"",maxlength:"2000"},null,8,["modelValue"]),e[8]||(e[8]=u("div",{class:"form-tip"}," 支持的格式：HLS (.m3u8)、MP4 (.mp4)、图片 (.jpg, .png, .gif) ",-1))]),_:1,__:[8]}),t(_,{label:"资源类型",prop:"resource_type",required:""},{default:a(()=>[t(S,{modelValue:l.resource_type,"onUpdate:modelValue":e[1]||(e[1]=d=>l.resource_type=d),placeholder:"选择资源类型"},{default:a(()=>[t(f,{label:"HLS",value:"hls"}),t(f,{label:"MP4",value:"mp4"}),t(f,{label:"图片",value:"image"})]),_:1},8,["modelValue"])]),_:1}),t(_,{prop:"video_id",style:{display:"none"}},{default:a(()=>[t(c,{modelValue:l.video_id,"onUpdate:modelValue":e[2]||(e[2]=d=>l.video_id=d)},null,8,["modelValue"])]),_:1}),t(_,{label:"直播间ID",prop:"liveroom_id",required:""},{default:a(()=>[t(c,{modelValue:l.liveroom_id,"onUpdate:modelValue":e[3]||(e[3]=d=>l.liveroom_id=d),placeholder:"请输入直播间ID",onInput:D},null,8,["modelValue"])]),_:1})]),u("div",W,[e[10]||(e[10]=u("h3",{class:"section-title"},"直播间信息",-1)),t(_,{label:"直播间标题",prop:"liveroom_title",required:""},{default:a(()=>[t(c,{modelValue:l.liveroom_title,"onUpdate:modelValue":e[4]||(e[4]=d=>l.liveroom_title=d),placeholder:"请输入直播间标题","show-word-limit":"",maxlength:"200"},null,8,["modelValue"])]),_:1}),t(_,{label:"直播间URL",prop:"liveroom_url",required:""},{default:a(()=>[t(c,{modelValue:l.liveroom_url,"onUpdate:modelValue":e[5]||(e[5]=d=>l.liveroom_url=d),placeholder:"请输入直播间URL","show-word-limit":"",maxlength:"500"},null,8,["modelValue"])]),_:1})]),u("div",Y,[t(v,{size:"large",onClick:L},{default:a(()=>e[11]||(e[11]=[b("重置")])),_:1,__:[11]}),t(v,{type:"primary",size:"large",onClick:U,loading:p.value},{default:a(()=>e[12]||(e[12]=[b(" 创建任务 ")])),_:1,__:[12]},8,["loading"])])]),_:1},8,["model"])]),_:1})])}}},ie=O(Z,[["__scopeId","data-v-35c252e0"]]);export{ie as default};

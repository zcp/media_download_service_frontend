import{aC as se,aB as ae,r as k,c as M,h as oe,S as ne,al as i,ar as re,y as p,z as n,Q as o,J as ie,I as a,A as t,K as u,H as v,u as D,M as d,O as r}from"./vue-CG64YRnT.js";import{a as ue}from"./index-DpMErgrC.js";import{f as B}from"./time-BU10aqh9.js";import{g as de,e as R,E as w}from"./elementPlus-Djpklj9S.js";import{_ as ce}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-Dq7h7Pqt.js";const _e={class:"task-detail-page"},pe={class:"detail-header"},ve={class:"header-left"},fe={key:0,class:"header-right"},me={class:"detail-content"},ge={class:"info-grid"},ye={class:"info-item"},ke={class:"info-item"},we={class:"info-item"},be={class:"info-item"},Ce={class:"info-item"},Te={class:"info-item"},he={class:"status-info"},De={class:"progress-section"},xe={class:"info-item"},Ie={class:"info-item"},Be={class:"info-item"},Fe={key:0,class:"info-item"},Se={class:"action-buttons"},Ee={key:1,class:"loading-container"},Me={key:2,class:"error-container"},Re={__name:"DownloadTaskDetail",setup(Ve){const V=se(),b=ae(),f=ue(),m=k(!1),C=k(""),x=k(!1),I=k(!1),g=k(null),_=M(()=>V.params.taskId),l=M(()=>f.currentTask);oe(async()=>{await T(),N()}),ne(()=>{P(),f.clearCurrentTask()});const T=async()=>{if(_.value){m.value=!0,C.value="";try{await f.fetchTaskDetail(_.value)}catch(s){C.value=s.message||"加载任务详情失败"}finally{m.value=!1}}},F=async()=>{await T(),w.success("刷新成功")},N=()=>{g.value||(g.value=setInterval(()=>{l.value&&["processing","pending"].includes(l.value.status)&&T()},3e3))},P=()=>{g.value&&(clearInterval(g.value),g.value=null)},U=async()=>{try{await R.confirm("确定要重试此任务吗？","确认重试",{type:"warning"}),x.value=!0,await f.retryTask(_.value),w.success("任务重试成功"),await T()}catch(s){s!=="cancel"&&w.error("重试失败")}finally{x.value=!1}},$=async()=>{try{await R.confirm("确定要取消此任务吗？","确认取消",{type:"warning"}),I.value=!0,await f.deleteTask(_.value),w.success("任务已取消"),b.push("/download-center/tasks")}catch(s){s!=="cancel"&&w.error("取消失败")}finally{I.value=!1}},z=()=>b.back(),A=()=>b.push(`/download-center/tasks/${_.value}/failures`),H=()=>b.push(`/download-center/tasks/${_.value}/videos`),J=s=>({pending:"待处理",processing:"处理中",completed:"已完成",partial_completed:"部分完成",failed:"失败",cancelled:"已取消"})[s]||s,K=s=>({pending:"",processing:"warning",completed:"success",partial_completed:"warning",failed:"danger",cancelled:"info"})[s]||"",L=s=>({completed:"#67C23A",failed:"#F56C6C",processing:"#409EFF"})[s]||"#409EFF",O=s=>s==="failed"?"exception":void 0,Q=s=>["failed","cancelled"].includes(s),j=s=>["pending","processing"].includes(s),q=s=>["failed","partial_completed"].includes(s),G=s=>s.length>60?`${s.slice(0,60)}...`:s;return(s,e)=>{const c=i("el-button"),S=i("el-tag"),y=i("el-card"),W=i("el-link"),h=i("el-col"),X=i("el-progress"),Y=i("el-alert"),Z=i("el-row"),ee=i("el-skeleton"),te=i("el-result"),le=re("loading");return n(),p("div",_e,[o(y,{class:"header-card",shadow:"never"},{default:a(()=>{var E;return[t("div",pe,[t("div",ve,[o(c,{onClick:z,icon:D(de),type:"text"},{default:a(()=>e[0]||(e[0]=[d("返回")])),_:1,__:[0]},8,["icon"]),e[1]||(e[1]=t("h2",{class:"page-title"},"任务详情",-1)),l.value?(n(),v(S,{key:0,type:K((E=l.value)==null?void 0:E.status),size:"large"},{default:a(()=>[d(r(J(l.value.status)),1)]),_:1},8,["type"])):u("",!0)]),l.value?(n(),p("div",fe,[Q(l.value.status)?(n(),v(c,{key:0,type:"warning",onClick:U,loading:x.value},{default:a(()=>e[2]||(e[2]=[d(" 重试任务 ")])),_:1,__:[2]},8,["loading"])):u("",!0),j(l.value.status)?(n(),v(c,{key:1,type:"danger",onClick:$,loading:I.value},{default:a(()=>e[3]||(e[3]=[d(" 取消任务 ")])),_:1,__:[3]},8,["loading"])):u("",!0),o(c,{onClick:F,loading:m.value},{default:a(()=>e[4]||(e[4]=[d("刷新")])),_:1,__:[4]},8,["loading"])])):u("",!0)])]}),_:1}),ie((n(),p("div",me,[l.value?(n(),v(Z,{key:0,gutter:24},{default:a(()=>[o(h,{span:24,lg:16},{default:a(()=>[o(y,{title:"基本信息",shadow:"never"},{default:a(()=>[t("div",ge,[t("div",ye,[e[5]||(e[5]=t("label",null,"任务ID:",-1)),t("span",null,r(l.value.id),1)]),t("div",ke,[e[6]||(e[6]=t("label",null,"视频ID:",-1)),t("span",null,r(l.value.video_id),1)]),t("div",we,[e[7]||(e[7]=t("label",null,"直播间ID:",-1)),t("span",null,r(l.value.liveroom_id),1)]),t("div",be,[e[8]||(e[8]=t("label",null,"直播间标题:",-1)),t("span",null,r(l.value.liveroom_title||"-"),1)]),t("div",Ce,[e[9]||(e[9]=t("label",null,"资源类型:",-1)),o(S,null,{default:a(()=>[d(r(l.value.resource_type.toUpperCase()),1)]),_:1})]),t("div",Te,[e[10]||(e[10]=t("label",null,"资源URL:",-1)),o(W,{href:l.value.resource_url,target:"_blank",type:"primary"},{default:a(()=>[d(r(G(l.value.resource_url)),1)]),_:1},8,["href"])])])]),_:1})]),_:1}),o(h,{span:24,lg:8},{default:a(()=>[o(y,{title:"状态信息",shadow:"never"},{default:a(()=>[t("div",he,[t("div",De,[e[11]||(e[11]=t("label",null,"下载进度:",-1)),o(X,{percentage:Math.round(l.value.progress*100),color:L(l.value.status),status:O(l.value.status),"stroke-width":"16"},null,8,["percentage","color","status"])]),t("div",xe,[e[12]||(e[12]=t("label",null,"重试次数:",-1)),t("span",null,r(l.value.retry_count),1)]),t("div",Ie,[e[13]||(e[13]=t("label",null,"创建时间:",-1)),t("span",null,r(D(B)(l.value.created_at)),1)]),t("div",Be,[e[14]||(e[14]=t("label",null,"更新时间:",-1)),t("span",null,r(D(B)(l.value.updated_at)),1)]),l.value.completed_at?(n(),p("div",Fe,[e[15]||(e[15]=t("label",null,"完成时间:",-1)),t("span",null,r(D(B)(l.value.completed_at)),1)])):u("",!0)])]),_:1})]),_:1}),l.value.last_error?(n(),v(h,{key:0,span:24},{default:a(()=>[o(y,{title:"错误信息",shadow:"never"},{default:a(()=>[o(Y,{title:l.value.last_error,type:"error",closable:!1,"show-icon":""},null,8,["title"])]),_:1})]),_:1})):u("",!0),o(h,{span:24},{default:a(()=>[o(y,{title:"相关操作",shadow:"never"},{default:a(()=>[t("div",Se,[q(l.value.status)?(n(),v(c,{key:0,type:"primary",onClick:A},{default:a(()=>e[16]||(e[16]=[d(" 查看失败记录 ")])),_:1,__:[16]})):u("",!0),o(c,{type:"success",onClick:H},{default:a(()=>e[17]||(e[17]=[d(" 查看已下载视频 ")])),_:1,__:[17]})])]),_:1})]),_:1})]),_:1})):u("",!0),m.value&&!l.value?(n(),p("div",Ee,[o(ee,{rows:8,animated:""})])):u("",!0),C.value?(n(),p("div",Me,[o(te,{icon:"error",title:"加载失败","sub-title":C.value},{extra:a(()=>[o(c,{type:"primary",onClick:F},{default:a(()=>e[18]||(e[18]=[d("重新加载")])),_:1,__:[18]})]),_:1},8,["sub-title"])])):u("",!0)])),[[le,m.value]])])}}},He=ce(Re,[["__scopeId","data-v-9a5f3435"]]);export{He as default};

import{aC as oe,aB as re,r as g,c as V,h as ie,S as ue,al as d,ar as de,y as m,z as o,Q as n,J as ce,I as s,A as t,K as r,H as p,u as D,M as i,O as u}from"./vue-CG64YRnT.js";import{a as _e}from"./index-uC5IX2IK.js";import{f as B}from"./time-BU10aqh9.js";import{g as pe,e as F,E as v}from"./elementPlus-Djpklj9S.js";import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-Dq7h7Pqt.js";const fe={class:"task-detail-page"},ge={class:"detail-header"},me={class:"header-left"},ye={key:0,class:"header-right"},ke={class:"detail-content"},we={class:"info-grid"},Ce={class:"info-item"},be={class:"info-item"},Te={class:"info-item"},he={class:"info-item"},De={class:"info-item"},xe={class:"info-item"},Ie={class:"status-info"},Se={class:"progress-section"},Be={class:"info-item"},Fe={class:"info-item"},Ee={class:"info-item"},Me={key:0,class:"info-item"},Re={class:"action-buttons"},Ve={key:1,class:"loading-container"},Ne={key:2,class:"error-container"},Pe={__name:"DownloadTaskDetail",setup(Ue){const N=oe(),b=re(),f=_e(),y=g(!1),T=g(""),x=g(!1),I=g(!1),S=g(!1),k=g(null),_=V(()=>N.params.taskId),l=V(()=>f.currentTask);ie(async()=>{await w(),P()}),ue(()=>{U(),f.clearCurrentTask()});const w=async()=>{if(_.value){y.value=!0,T.value="";try{await f.fetchTaskDetail(_.value)}catch(a){T.value=a.message||"加载任务详情失败"}finally{y.value=!1}}},E=async()=>{await w(),v.success("刷新成功")},P=()=>{k.value||(k.value=setInterval(()=>{l.value&&["processing","pending"].includes(l.value.status)&&w()},3e3))},U=()=>{k.value&&(clearInterval(k.value),k.value=null)},$=async()=>{try{await F.confirm("确定要开始下载此任务吗？","确认开始下载",{type:"info"}),x.value=!0,await f.startTask(_.value),v.success("任务开始下载成功"),await w()}catch(a){a!=="cancel"&&v.error("开始下载失败")}finally{x.value=!1}},z=async()=>{try{await F.confirm("确定要重试此任务吗？","确认重试",{type:"warning"}),I.value=!0,await f.retryTask(_.value),v.success("任务重试成功"),await w()}catch(a){a!=="cancel"&&v.error("重试失败")}finally{I.value=!1}},A=async()=>{try{await F.confirm("确定要取消此任务吗？","确认取消",{type:"warning"}),S.value=!0,await f.deleteTask(_.value),v.success("任务已取消"),b.push("/download-center/tasks")}catch(a){a!=="cancel"&&v.error("取消失败")}finally{S.value=!1}},H=()=>b.back(),J=()=>b.push(`/download-center/tasks/${_.value}/failures`),K=()=>b.push(`/download-center/tasks/${_.value}/videos`),L=a=>({pending:"待处理",processing:"处理中",completed:"已完成",partial_completed:"部分完成",failed:"失败",cancelled:"已取消"})[a]||a,O=a=>({pending:"",processing:"warning",completed:"success",partial_completed:"warning",failed:"danger",cancelled:"info"})[a]||"",Q=a=>({completed:"#67C23A",failed:"#F56C6C",processing:"#409EFF"})[a]||"#409EFF",j=a=>a==="failed"?"exception":void 0,q=a=>["pending"].includes(a),G=a=>["failed","cancelled","partial_completed"].includes(a),W=a=>["pending","processing"].includes(a),X=a=>["failed","partial_completed"].includes(a),Y=a=>a.length>60?`${a.slice(0,60)}...`:a;return(a,e)=>{const c=d("el-button"),M=d("el-tag"),C=d("el-card"),Z=d("el-link"),h=d("el-col"),ee=d("el-progress"),te=d("el-alert"),le=d("el-row"),ae=d("el-skeleton"),se=d("el-result"),ne=de("loading");return o(),m("div",fe,[n(C,{class:"header-card",shadow:"never"},{default:s(()=>{var R;return[t("div",ge,[t("div",me,[n(c,{onClick:H,icon:D(pe),type:"text"},{default:s(()=>e[0]||(e[0]=[i("返回")])),_:1,__:[0]},8,["icon"]),e[1]||(e[1]=t("h2",{class:"page-title"},"任务详情",-1)),l.value?(o(),p(M,{key:0,type:O((R=l.value)==null?void 0:R.status),size:"large"},{default:s(()=>[i(u(L(l.value.status)),1)]),_:1},8,["type"])):r("",!0)]),l.value?(o(),m("div",ye,[q(l.value.status)?(o(),p(c,{key:0,type:"success",onClick:$,loading:x.value},{default:s(()=>e[2]||(e[2]=[i(" 开始下载 ")])),_:1,__:[2]},8,["loading"])):r("",!0),G(l.value.status)?(o(),p(c,{key:1,type:"warning",onClick:z,loading:I.value},{default:s(()=>e[3]||(e[3]=[i(" 重试任务 ")])),_:1,__:[3]},8,["loading"])):r("",!0),W(l.value.status)?(o(),p(c,{key:2,type:"danger",onClick:A,loading:S.value},{default:s(()=>e[4]||(e[4]=[i(" 取消任务 ")])),_:1,__:[4]},8,["loading"])):r("",!0),n(c,{onClick:E,loading:y.value},{default:s(()=>e[5]||(e[5]=[i("刷新")])),_:1,__:[5]},8,["loading"])])):r("",!0)])]}),_:1}),ce((o(),m("div",ke,[l.value?(o(),p(le,{key:0,gutter:24},{default:s(()=>[n(h,{span:24,lg:16},{default:s(()=>[n(C,{title:"基本信息",shadow:"never"},{default:s(()=>[t("div",we,[t("div",Ce,[e[6]||(e[6]=t("label",null,"任务ID:",-1)),t("span",null,u(l.value.id),1)]),t("div",be,[e[7]||(e[7]=t("label",null,"视频ID:",-1)),t("span",null,u(l.value.video_id),1)]),t("div",Te,[e[8]||(e[8]=t("label",null,"直播间ID:",-1)),t("span",null,u(l.value.liveroom_id),1)]),t("div",he,[e[9]||(e[9]=t("label",null,"直播间标题:",-1)),t("span",null,u(l.value.liveroom_title||"-"),1)]),t("div",De,[e[10]||(e[10]=t("label",null,"资源类型:",-1)),n(M,null,{default:s(()=>[i(u(l.value.resource_type.toUpperCase()),1)]),_:1})]),t("div",xe,[e[11]||(e[11]=t("label",null,"资源URL:",-1)),n(Z,{href:l.value.resource_url,target:"_blank",type:"primary"},{default:s(()=>[i(u(Y(l.value.resource_url)),1)]),_:1},8,["href"])])])]),_:1})]),_:1}),n(h,{span:24,lg:8},{default:s(()=>[n(C,{title:"状态信息",shadow:"never"},{default:s(()=>[t("div",Ie,[t("div",Se,[e[12]||(e[12]=t("label",null,"下载进度:",-1)),n(ee,{percentage:Math.round(l.value.progress*100),color:Q(l.value.status),status:j(l.value.status),"stroke-width":"16"},null,8,["percentage","color","status"])]),t("div",Be,[e[13]||(e[13]=t("label",null,"重试次数:",-1)),t("span",null,u(l.value.retry_count),1)]),t("div",Fe,[e[14]||(e[14]=t("label",null,"创建时间:",-1)),t("span",null,u(D(B)(l.value.created_at)),1)]),t("div",Ee,[e[15]||(e[15]=t("label",null,"更新时间:",-1)),t("span",null,u(D(B)(l.value.updated_at)),1)]),l.value.completed_at?(o(),m("div",Me,[e[16]||(e[16]=t("label",null,"完成时间:",-1)),t("span",null,u(D(B)(l.value.completed_at)),1)])):r("",!0)])]),_:1})]),_:1}),l.value.last_error?(o(),p(h,{key:0,span:24},{default:s(()=>[n(C,{title:"错误信息",shadow:"never"},{default:s(()=>[n(te,{title:l.value.last_error,type:"error",closable:!1,"show-icon":""},null,8,["title"])]),_:1})]),_:1})):r("",!0),n(h,{span:24},{default:s(()=>[n(C,{title:"相关操作",shadow:"never"},{default:s(()=>[t("div",Re,[X(l.value.status)?(o(),p(c,{key:0,type:"primary",onClick:J},{default:s(()=>e[17]||(e[17]=[i(" 查看失败记录 ")])),_:1,__:[17]})):r("",!0),n(c,{type:"success",onClick:K},{default:s(()=>e[18]||(e[18]=[i(" 查看已下载视频 ")])),_:1,__:[18]})])]),_:1})]),_:1})]),_:1})):r("",!0),y.value&&!l.value?(o(),m("div",Ve,[n(ae,{rows:8,animated:""})])):r("",!0),T.value?(o(),m("div",Ne,[n(se,{icon:"error",title:"加载失败","sub-title":T.value},{extra:s(()=>[n(c,{type:"primary",onClick:E},{default:s(()=>e[19]||(e[19]=[i("重新加载")])),_:1,__:[19]})]),_:1},8,["sub-title"])])):r("",!0)])),[[ne,y.value]])])}}},Le=ve(Pe,[["__scopeId","data-v-7057a0ad"]]);export{Le as default};

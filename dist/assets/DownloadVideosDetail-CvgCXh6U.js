import{aC as Q,aB as q,r as f,c as C,h as W,al as p,ar as X,y as D,z as y,Q as l,I as s,A as a,u,M as r,O as n,J as Y,H as Z,K as S}from"./vue-CG64YRnT.js";import{a as ee}from"./index-DUeX6V2y.js";import{b as te,c as ae,f as V}from"./time-BU10aqh9.js";import{E as c,g as le,h as oe}from"./elementPlus-Djpklj9S.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./utils-Dq7h7Pqt.js";const ne={class:"videos-page"},ie={class:"page-header"},de={class:"header-left"},re={class:"page-title"},ue={class:"header-right"},pe={class:"path-item"},ce={class:"pagination-area"},_e={key:0,class:"video-detail"},me={class:"detail-grid"},ve={class:"detail-item"},ge={class:"detail-item"},fe={class:"detail-item"},he={class:"detail-item"},we={class:"path-detail"},be={key:0,class:"detail-item"},ye={class:"detail-item"},ke={class:"detail-item"},ze={__name:"DownloadVideosDetail",setup(Ce){const B=Q(),U=q(),h=ee(),_=f(!1),m=f(1),w=f(20),k=f(!1),i=f(null),v=C(()=>B.params.taskId),M=C(()=>v.value?`已下载视频列表（任务 ${v.value}）`:"已下载视频列表"),T=C(()=>!v.value);W(async()=>{await b()});const b=async()=>{_.value=!0;try{console.log("开始获取视频列表..."),console.log("是否为全局视频页面:",T.value),console.log("任务ID:",v.value);const t=T.value?null:v.value;console.log("使用的任务ID:",t);const e={page:m.value,size:w.value};console.log("查询参数:",e),await h.fetchVideos(t,e),console.log("视频列表获取成功")}catch(t){console.error("获取视频列表失败:",t),console.error("错误详情:",{message:t.message,code:t.code,response:t.response,status:t.status}),t.message&&t.message.includes("500")?c.error("服务器内部错误，请稍后重试或联系管理员"):t.message&&t.message.includes("404")?c.error("接口不存在，请联系管理员"):c.error("获取视频列表失败，请重试")}finally{_.value=!1}},$=async()=>{await b(),c.success("刷新成功")},N=async t=>{w.value=t,m.value=1,await b()},R=async t=>{m.value=t,await b()},E=t=>{i.value=t,k.value=!0},x=async t=>{try{await navigator.clipboard.writeText(t),c.success("路径已复制到剪贴板")}catch{c.error("复制失败")}},H=()=>U.back(),P=t=>({hls:"primary",mp4:"success",image:"warning"})[t]||"",j=t=>({completed:"已完成",partial_completed:"部分完成",failed:"失败"})[t]||t,A=t=>({completed:"success",partial_completed:"warning",failed:"danger"})[t]||"";return(t,e)=>{const g=p("el-button"),z=p("el-tag"),I=p("el-card"),d=p("el-table-column"),F=p("el-table"),G=p("el-pagination"),J=p("el-link"),K=p("el-dialog"),L=X("loading");return y(),D("div",ne,[l(I,{class:"header-card",shadow:"never"},{default:s(()=>[a("div",ie,[a("div",de,[l(g,{onClick:H,icon:u(le),type:"text"},{default:s(()=>e[5]||(e[5]=[r("返回")])),_:1,__:[5]},8,["icon"]),a("h2",re,n(M.value),1),l(z,{type:"info",size:"large"},{default:s(()=>[r(" 共 "+n(u(h).videosTotal)+" 个视频 ",1)]),_:1})]),a("div",ue,[l(g,{onClick:$,loading:_.value},{default:s(()=>e[6]||(e[6]=[r("刷新")])),_:1,__:[6]},8,["loading"])])])]),_:1}),l(I,{class:"table-card",shadow:"never"},{default:s(()=>[Y((y(),Z(F,{data:u(h).videos,loading:_.value,border:"",stripe:"",height:"600"},{default:s(()=>[l(d,{prop:"id",label:"视频ID",width:"280","show-overflow-tooltip":""}),l(d,{prop:"video_id",label:"文件标识",width:"200","show-overflow-tooltip":""}),l(d,{prop:"liveroom_id",label:"直播间ID",width:"120"}),l(d,{prop:"resource_type",label:"类型",width:"100"},{default:s(({row:o})=>[l(z,{type:P(o.resource_type),size:"small"},{default:s(()=>[r(n(o.resource_type.toUpperCase()),1)]),_:2},1032,["type"])]),_:1}),l(d,{prop:"file_size",label:"文件大小",width:"120"},{default:s(({row:o})=>[r(n(u(te)(o.file_size)),1)]),_:1}),l(d,{prop:"duration",label:"时长",width:"100"},{default:s(({row:o})=>[r(n(u(ae)(o.duration)),1)]),_:1}),l(d,{prop:"resolution",label:"分辨率",width:"120"}),l(d,{prop:"format",label:"格式",width:"80"}),l(d,{prop:"storage_path",label:"存储路径",width:"300","show-overflow-tooltip":""},{default:s(({row:o})=>[a("div",pe,[a("span",null,n(o.storage_path),1),l(g,{size:"small",text:"",onClick:O=>x(o.storage_path),icon:u(oe)},null,8,["onClick","icon"])])]),_:1}),l(d,{prop:"status",label:"状态",width:"100"},{default:s(({row:o})=>[l(z,{type:A(o.status),size:"small"},{default:s(()=>[r(n(j(o.status)),1)]),_:2},1032,["type"])]),_:1}),l(d,{prop:"download_end_time",label:"完成时间",width:"160"},{default:s(({row:o})=>[r(n(u(V)(o.download_end_time,"MM-DD HH:mm")),1)]),_:1}),l(d,{label:"操作",width:"120",fixed:"right"},{default:s(({row:o})=>[l(g,{size:"small",type:"primary",onClick:O=>E(o)},{default:s(()=>e[7]||(e[7]=[r(" 详情 ")])),_:2,__:[7]},1032,["onClick"])]),_:1})]),_:1},8,["data","loading"])),[[L,_.value]]),a("div",ce,[l(G,{"current-page":m.value,"onUpdate:currentPage":e[0]||(e[0]=o=>m.value=o),"page-size":w.value,"onUpdate:pageSize":e[1]||(e[1]=o=>w.value=o),"page-sizes":[10,20,50,100],total:u(h).videosTotal,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:N,onCurrentChange:R},null,8,["current-page","page-size","total"])])]),_:1}),l(K,{modelValue:k.value,"onUpdate:modelValue":e[3]||(e[3]=o=>k.value=o),title:"视频详情",width:"600px",onClose:e[4]||(e[4]=o=>i.value=null)},{default:s(()=>[i.value?(y(),D("div",_e,[a("div",me,[a("div",ve,[e[8]||(e[8]=a("label",null,"视频ID:",-1)),a("span",null,n(i.value.video_id),1)]),a("div",ge,[e[9]||(e[9]=a("label",null,"直播间标题:",-1)),a("span",null,n(i.value.liveroom_title||"-"),1)]),a("div",fe,[e[11]||(e[11]=a("label",null,"资源URL:",-1)),l(J,{href:i.value.resource_url,target:"_blank",type:"primary"},{default:s(()=>e[10]||(e[10]=[r(" 查看原始资源 ")])),_:1,__:[10]},8,["href"])]),a("div",he,[e[13]||(e[13]=a("label",null,"存储路径:",-1)),a("div",we,[a("span",null,n(i.value.storage_path),1),l(g,{size:"small",onClick:e[2]||(e[2]=o=>x(i.value.storage_path))},{default:s(()=>e[12]||(e[12]=[r(" 复制路径 ")])),_:1,__:[12]})])]),i.value.cover_path?(y(),D("div",be,[e[14]||(e[14]=a("label",null,"封面路径:",-1)),a("span",null,n(i.value.cover_path),1)])):S("",!0),a("div",ye,[e[15]||(e[15]=a("label",null,"下载开始时间:",-1)),a("span",null,n(u(V)(i.value.download_start_time)),1)]),a("div",ke,[e[16]||(e[16]=a("label",null,"下载结束时间:",-1)),a("span",null,n(u(V)(i.value.download_end_time)),1)])])])):S("",!0)]),_:1},8,["modelValue"])])}}},Be=se(ze,[["__scopeId","data-v-6db2835a"]]);export{Be as default};

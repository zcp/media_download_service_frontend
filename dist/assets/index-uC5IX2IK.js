const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/DownloadCenter-GHNYxD0z.js","assets/vue-CG64YRnT.js","assets/elementPlus-Djpklj9S.js","assets/_plugin-vue_export-helper-DlAUqK2U.js","assets/utils-Dq7h7Pqt.js","assets/DownloadCenter-C8_EKZSy.css","assets/DownloadTaskList-BLUuaHTE.js","assets/time-BU10aqh9.js","assets/DownloadTaskList-CQjUtyvr.css","assets/DownloadTaskCreate-BoeZmmfC.js","assets/DownloadTaskCreate-Ki4apX3i.css","assets/DownloadTaskDetail-DOhBgmyJ.js","assets/DownloadTaskDetail-C5XQh2_9.css","assets/DownloadFailures-BQPOndkM.js","assets/DownloadFailures-DCp7pk30.css","assets/DownloadVideosDetail-DyRP_xv1.js","assets/DownloadVideosDetail-DnuFTHFv.css","assets/AuthCallback-wgzNuSBI.js","assets/AuthCallback-BuT-f3AF.css","assets/NotFound-BzQxAsOC.js","assets/NotFound-DfQzYYFq.css"])))=>i.map(i=>d[i]);
import{ax as C,h as W,S as z,al as H,y as M,z as D,Q as R,I as V,T as J,H as Q,L as K,ay as X,az as Y,au as Z,aA as ee}from"./vue-CG64YRnT.js";import{E as d,a as te,i as re,b as oe}from"./elementPlus-Djpklj9S.js";import{a as se}from"./utils-Dq7h7Pqt.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();function ne(e){if(!e)return console.log("Token验证: Token为空"),!0;try{const t=JSON.parse(atob(e.split(".")[1])),r=Date.now()/1e3,s=t.exp<=r;return console.log("Token验证:",{token:e.substring(0,20)+"...",exp:t.exp,currentTime:r,isExpired:s,timeLeft:t.exp-r}),s}catch(t){return console.error("Token解析失败:",t),!0}}function O(e){if(!e)return null;try{const t=JSON.parse(atob(e.split(".")[1]));return{user_id:t.user_id||t.sub,username:t.username,email:t.email}}catch(t){return console.error("Token用户信息解析失败:",t),null}}function ae(e){if(!e)return null;try{return JSON.parse(atob(e.split(".")[1])).exp*1e3}catch(t){return console.error("Token过期时间解析失败:",t),null}}function m(e){return e&&!ne(e)}function ie(){try{return localStorage.getItem("jwt_token")}catch(e){return console.error("获取存储的Token失败:",e),null}}function le(e){try{localStorage.setItem("jwt_token",e)}catch(t){console.error("存储Token失败:",t)}}function N(){try{localStorage.removeItem("jwt_token")}catch(e){console.error("移除Token失败:",e)}}const I={BASE_URL:"/download-center/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_API_BASE_URL:"/api/v1",VITE_APP_BASE_URL:"/download-center/",VITE_REQUEST_TIMEOUT:"15000",VITE_USER_NODE_ENV:"production"},ce=()=>{typeof window<"u"&&!window.__ENV&&console.warn("配置尚未加载，请确保 config/env.js 在此文件之前引入")};typeof window<"u"&&ce();const w=e=>{var o;const t=I==null?void 0:I[e],r=typeof window<"u"?(o=window.__ENV)==null?void 0:o[e]:void 0,s=t||r||"";return console.log(`读取环境变量 ${e}:`,{viteEnv:t,runtimeEnv:r,result:s,windowEnv:typeof window<"u"?window.__ENV:"window未定义"}),s},q=(w("VITE_BASE_API_URL")||"http://localhost:8000/").replace(/\/?$/,"/"),ue=(w("VITE_AUTH_API_URL")||"http://localhost:8002/").replace(/\/?$/,"/"),_=w("VITE_LOGIN_URL")||(typeof window<"u"?`${window.location.protocol}//${window.location.host}/pages/auth/login`:""),Oe=w("VITE_FRONTEND_USER_URL")||(typeof window<"u"?`${window.location.protocol}//${window.location.host}`:""),S=w("VITE_APP_BASE_PATH")||"/download-center/",de=w("VITE_APP_TITLE")||"媒体下载服务",j=parseInt(w("VITE_API_TIMEOUT"))||3e4,he=parseInt(w("VITE_POLLING_INTERVAL"))||5e3,fe=w("VITE_WS_URL")||"";console.log("API配置常量:",{BASE_API_URL:q,AUTH_API_URL:ue,LOGIN_URL:_,APP_BASE_PATH:S,APP_TITLE:de,API_TIMEOUT:j,POLLING_INTERVAL:he,WS_URL:fe});const P=C("auth",{state:()=>({user:null,token:null,isAuthenticated:!1,tokenExpiry:null,redirectPath:null}),getters:{isTokenValidGetter:e=>e.token?m(e.token):!1,userId:e=>{var t;return((t=e.user)==null?void 0:t.user_id)||null},username:e=>{var t;return((t=e.user)==null?void 0:t.username)||""},userEmail:e=>{var t;return((t=e.user)==null?void 0:t.email)||""},needsReauth:e=>!e.isAuthenticated||!m(e.token)},actions:{setToken(e){if(!e||!m(e))return console.warn("尝试设置无效的Token"),!1;try{const t=O(e);if(!t)throw new Error("无法解析用户信息");return this.token=e,this.user=t,this.tokenExpiry=ae(e),this.isAuthenticated=!0,le(e),console.log("Token设置成功:",t),!0}catch(t){return console.error("设置Token失败:",t),this.clearAuth(),!1}},clearAuth(){this.user=null,this.token=null,this.isAuthenticated=!1,this.tokenExpiry=null,N(),console.log("认证信息已清除")},setRedirectPath(e){this.redirectPath=e;try{sessionStorage.setItem("auth_redirect_path",e)}catch(t){console.warn("保存重定向路径失败:",t)}},getRedirectPath(){if(this.redirectPath)return this.redirectPath;try{return sessionStorage.getItem("auth_redirect_path")}catch(e){return console.warn("获取重定向路径失败:",e),null}},clearRedirectPath(){this.redirectPath=null;try{sessionStorage.removeItem("auth_redirect_path")}catch(e){console.warn("清除重定向路径失败:",e)}},async initializeAuth(){console.log("初始化认证状态...");try{const e=ie();if(!e)return console.log("未找到保存的Token"),!1;if(m(e)){if(this.setToken(e))return console.log("认证状态恢复成功"),!0}else console.log("保存的Token已过期");return this.clearAuth(),!1}catch(e){return console.error("初始化认证状态失败:",e),this.clearAuth(),!1}},checkTokenExpiry(){if(!this.token)return console.log("Token检查：无Token"),!1;const e=m(this.token);return e||(console.log("Token检查：已过期"),this.clearAuth()),e},parseUserFromToken(e){try{const t=O(e);if(t)this.user=t,console.log("用户信息解析成功:",t);else throw new Error("解析失败")}catch(t){console.error("解析Token用户信息失败:",t),this.clearAuth()}},handleAuthRedirect(){const e=this.getRedirectPath();if(e&&e!=="/login"){console.log("重定向到:",e),this.clearRedirectPath();const t=this.$router||window.$router;t?t.push(e):window.location.href=e}else{console.log("重定向到默认页面");const t=this.$router||window.$router;t?t.push("/download-center/tasks"):window.location.href="/download-center/tasks"}},logout(){console.log("用户登出"),this.clearAuth(),this.clearRedirectPath(),setTimeout(()=>{window.location.href=_},100)},forceReauth(e=null){console.log("强制重新认证"),e&&this.setRedirectPath(e),this.clearAuth(),setTimeout(()=>{window.location.href=_},100)}}}),v=se.create({baseURL:q,timeout:j,headers:{"Content-Type":"application/json"}});let A=null,y=0;function pe(){y===0&&(A=te.service({lock:!0,text:"加载中...",background:"rgba(0, 0, 0, 0.7)"})),y++}function $(){y--,y<=0&&(y=0,A&&(A.close(),A=null))}v.interceptors.request.use(e=>{var r;const t=localStorage.getItem("jwt_token");return t&&m(t)&&(e.headers.Authorization=`Bearer ${t}`),e.hideLoading||pe(),console.log("发送请求:",(r=e.method)==null?void 0:r.toUpperCase(),e.url,e.data||e.params),e},e=>($(),console.error("请求配置错误:",e),d.error("请求配置错误"),Promise.reject(e)));v.interceptors.response.use(e=>{var o;$(),console.log("收到响应:",(o=e.config.method)==null?void 0:o.toUpperCase(),e.config.url,e.data);const{code:t,message:r,data:s}=e.data;return t===200||t===201||t===204?s:(console.error("业务错误:",t,r),d.error(r||"请求失败"),Promise.reject(new Error(r||"请求失败")))},e=>{if($(),console.error("请求错误:",e),e.response){const{status:t,data:r}=e.response;switch(t){case 401:const s=P();s.clearAuth(),N(),s.setRedirectPath(window.location.pathname),d.error("登录已过期，请重新登录"),setTimeout(()=>{window.location.href=_},1e3);break;case 403:d.error("没有权限访问该资源");break;case 404:d.error("请求的资源不存在");break;case 500:d.error("服务器内部错误");break;default:const o=(r==null?void 0:r.message)||`请求失败 (${t})`;d.error(o)}}else e.code==="ECONNABORTED"?d.error("请求超时，请检查网络连接"):e.message==="Network Error"?d.error("网络连接错误，请检查网络"):d.error(e.message||"未知错误");return Promise.reject(e)});function b(e,t={},r={}){return v.get(e,{params:t,...r})}function p(e,t={},r={}){return v.post(e,t,r)}function we(e,t={}){return v.delete(e,t)}function E(e,t={},r={}){const{page:s=1,size:o=20,sort:a,...n}=t,i={page:s,size:o,...n};return a&&(i.sort=a),b(e,i,r)}const c={getTasks(e={}){return E("/api/v1/download/tasks",e)},createTask(e){const t=["resource_url","resource_type","video_id","liveroom_id"];for(const s of t)if(!e[s])throw new Error(`缺少必填字段: ${s}`);const r=["hls","mp4","image"];if(!r.includes(e.resource_type))throw new Error(`无效的资源类型: ${e.resource_type}，必须是: ${r.join(", ")}`);return p("/api/v1/download/tasks",e)},getTaskDetail(e){if(!e)throw new Error("任务ID不能为空");return b(`/api/v1/download/tasks/${e}`)},deleteTask(e){if(!e)throw new Error("任务ID不能为空");return we(`/api/v1/download/tasks/${e}`)},startTask(e){if(!e)throw new Error("任务ID不能为空");return p(`/api/v1/download/tasks/${e}/start`)},retryTask(e){if(!e)throw new Error("任务ID不能为空");return p(`/api/v1/download/tasks/${e}/retry`)},getFailures(e,t={}){if(!e)throw new Error("任务ID不能为空");return E(`/api/v1/download/tasks/${e}/failures`,t)},getGlobalFailures(e={}){return E("/api/v1/download/failures",e)},createFailure(e,t){if(!e)throw Error("任务ID不能为空");return p(`/api/v1/download/tasks/${e}/failures`,t)},retryFailure(e,t){if(!e||!t)throw new Error("任务ID和失败记录ID不能为空");return p(`/api/v1/download/tasks/${e}/failures/${t}/retry`)},retryGlobalFailure(e){if(!e)throw new Error("失败记录ID不能为空");return p(`/api/v1/download/failures/${e}/retry`)},abandonFailure(e,t){if(!e||!t)throw new Error("任务ID和失败记录ID不能为空");return p(`/api/v1/download/tasks/${e}/failures/${t}/abandon`)},abandonGlobalFailure(e){if(!e)throw new Error("失败记录ID不能为空");return p(`/api/v1/download/failures/${e}/abandon`)},createVideo(e,t){if(!e)throw new Error("任务ID不能为空");return p(`/api/v1/download/tasks/${e}/videos`,t)},getVideos(e,t={}){if(!e)throw new Error("任务ID不能为空");return E(`/api/v1/download/tasks/${e}/videos`,t)},getGlobalVideos(e={}){return E("/api/v1/download/videos",e)},async batchOperateTasks(e,t){if(!Array.isArray(e)||e.length===0)throw new Error("任务ID列表不能为空");const r=["retry","delete","start"];if(!r.includes(t))throw new Error(`无效的操作类型: ${t}，必须是: ${r.join(", ")}`);const s=[],o=[];for(const a of e)try{let n;switch(t){case"retry":n=await this.retryTask(a);break;case"delete":n=await this.deleteTask(a);break;case"start":n=await this.startTask(a);break}s.push({taskId:a,success:!0,data:n})}catch(n){o.push({taskId:a,success:!1,error:n.message})}return{success:s,errors:o,total:e.length,successCount:s.length,errorCount:o.length}},getTaskStats(){return b("/api/v1/download/tasks/stats")},searchTasks(e,t={}){if(!e)throw new Error("搜索关键词不能为空");return E("/api/v1/download/tasks",{...t,search:e})},exportTasks(e={},t="csv"){const r=["csv","excel"];if(!r.includes(t))throw new Error(`无效的导出格式: ${t}，必须是: ${r.join(", ")}`);return b("/api/v1/download/tasks/export",{...e,format:t},{responseType:"blob"})}},ge=C("download",{state:()=>({tasks:[],tasksTotal:0,tasksLoading:!1,tasksError:null,currentTask:null,currentTaskLoading:!1,currentTaskError:null,failures:[],failuresTotal:0,failuresLoading:!1,failuresError:null,videos:[],videosTotal:0,videosLoading:!1,videosError:null,tasksParams:{page:1,size:20,sort:"created_at:desc",status:void 0,resource_type:void 0,liveroom_id:void 0},failuresParams:{page:1,size:20,sort:"created_at:desc",status:void 0,failure_type:void 0},videosParams:{page:1,size:20,sort:"created_at:desc",resource_type:void 0},pollingInterval:null,pollingEnabled:!1,websocketConnection:null}),getters:{getTaskCountByStatus:e=>t=>e.tasks.filter(r=>r.status===t).length,getProcessingTasks:e=>e.tasks.filter(t=>t.status==="processing"||t.status==="pending"),getCompletedTasks:e=>e.tasks.filter(t=>t.status==="completed"||t.status==="partial_completed"),getFailedTasks:e=>e.tasks.filter(t=>t.status==="failed"),hasProcessingTasks:e=>e.tasks.some(t=>t.status==="processing"||t.status==="pending")},actions:{async fetchTasks(e={},t=!1){(t||!this.tasks.length)&&(this.tasksLoading=!0),this.tasksError=null;try{const r={...this.tasksParams,...e};this.tasksParams=r;const s=Object.fromEntries(Object.entries(r).filter(([a,n])=>n!=null&&n!==""));console.log("发送查询参数:",s);const o=await c.getTasks(s);this.tasks=o.items||[],this.tasksTotal=o.total||0,console.log(`获取任务列表成功: ${this.tasks.length}/${this.tasksTotal}`)}catch(r){console.error("获取任务列表失败:",r),this.tasksError=r.message,this.tasks=[],this.tasksTotal=0}finally{this.tasksLoading=!1}},async refreshTasks(){await this.fetchTasks(this.tasksParams)},async createTask(e){try{const t=await c.createTask(e);return this.tasks.unshift(t),this.tasksTotal+=1,console.log("任务创建成功:",t.id),t}catch(t){throw console.error("创建任务失败:",t),t}},async deleteTask(e){var t;try{await c.deleteTask(e);const r=this.tasks.findIndex(s=>s.id===e);r!==-1&&(this.tasks.splice(r,1),this.tasksTotal-=1),((t=this.currentTask)==null?void 0:t.id)===e&&(this.currentTask=null),console.log("任务删除成功:",e)}catch(r){throw console.error("删除任务失败:",r),r}},async startTask(e){var t;try{const r=await c.startTask(e);return this.updateTaskInList(r),((t=this.currentTask)==null?void 0:t.id)===e&&(this.currentTask=r),console.log("任务开始下载成功:",e),r}catch(r){throw console.error("开始下载任务失败:",r),r}},async retryTask(e){var t;try{const r=await c.retryTask(e);return this.updateTaskInList(r),((t=this.currentTask)==null?void 0:t.id)===e&&(this.currentTask=r),console.log("任务重试成功:",e),r}catch(r){throw console.error("重试任务失败:",r),r}},async fetchTaskDetail(e){this.currentTaskLoading=!0,this.currentTaskError=null;try{const t=await c.getTaskDetail(e);return this.currentTask=t,this.updateTaskInList(t),console.log("获取任务详情成功:",e),t}catch(t){throw console.error("获取任务详情失败:",t),this.currentTaskError=t.message,this.currentTask=null,t}finally{this.currentTaskLoading=!1}},clearCurrentTask(){this.currentTask=null,this.currentTaskError=null},async fetchFailures(e,t={}){this.failuresLoading=!0,this.failuresError=null;try{const r={...this.failuresParams,...t};this.failuresParams=r;let s;e?s=await c.getFailures(e,r):s=await c.getGlobalFailures(r),this.failures=s.items||[],this.failuresTotal=s.total||0,console.log(`获取失败记录成功: ${this.failures.length}/${this.failuresTotal}`)}catch(r){console.error("获取失败记录失败:",r),this.failuresError=r.message,this.failures=[],this.failuresTotal=0}finally{this.failuresLoading=!1}},async retryFailure(e,t){try{e?await c.retryFailure(e,t):await c.retryGlobalFailure(t),await this.fetchFailures(e,this.failuresParams),console.log("失败记录重试成功:",t)}catch(r){throw console.error("重试失败记录失败:",r),r}},async abandonFailure(e,t){try{e?await c.abandonFailure(e,t):await c.abandonGlobalFailure(t),await this.fetchFailures(e,this.failuresParams),console.log("失败记录放弃成功:",t)}catch(r){throw console.error("放弃失败记录失败:",r),r}},async fetchVideos(e,t={}){this.videosLoading=!0,this.videosError=null;try{const r=Object.fromEntries(Object.entries(t).filter(([a,n])=>n!=null)),s={...this.videosParams,...r};this.videosParams=s,console.log("Store fetchVideos - 清理后的参数:",r),console.log("Store fetchVideos - 最终查询参数:",s),console.log("Store fetchVideos - 任务ID:",e);let o;e?(console.log("Store fetchVideos - 调用 getVideos"),o=await c.getVideos(e,s)):(console.log("Store fetchVideos - 调用 getGlobalVideos"),o=await c.getGlobalVideos(s)),this.videos=o.items||[],this.videosTotal=o.total||0,console.log(`获取已下载视频成功: ${this.videos.length}/${this.videosTotal}`)}catch(r){console.error("获取已下载视频失败:",r),this.videosError=r.message,this.videos=[],this.videosTotal=0}finally{this.videosLoading=!1}},updateTaskInList(e){const t=this.tasks.findIndex(r=>r.id===e.id);t!==-1&&(this.tasks[t]={...this.tasks[t],...e})},resetAllState(){this.tasks=[],this.tasksTotal=0,this.currentTask=null,this.failures=[],this.failuresTotal=0,this.videos=[],this.videosTotal=0,this.tasksError=null,this.currentTaskError=null,this.failuresError=null,this.videosError=null,this.stopPolling(),this.disconnectWebSocket()},startPolling(e=5e3){this.stopPolling(),this.pollingEnabled=!0,this.pollingInterval=setInterval(async()=>{this.pollingEnabled&&(this.hasProcessingTasks&&await this.refreshTasks(),this.currentTask&&(this.currentTask.status==="processing"||this.currentTask.status==="pending")&&await this.fetchTaskDetail(this.currentTask.id))},e),console.log(`开始轮询更新，间隔: ${e}ms`)},stopPolling(){this.pollingInterval&&(clearInterval(this.pollingInterval),this.pollingInterval=null),this.pollingEnabled=!1,console.log("停止轮询更新")},connectWebSocket(){console.log("WebSocket连接功能待实现")},disconnectWebSocket(){this.websocketConnection&&(this.websocketConnection.close(),this.websocketConnection=null)}}}),ke={id:"app"},me={__name:"App",setup(e){const t=P(),r=ge();W(()=>{console.log("App组件已挂载"),document.addEventListener("visibilitychange",s),window.addEventListener("beforeunload",o)}),z(()=>{console.log("App组件已卸载"),document.removeEventListener("visibilitychange",s),window.removeEventListener("beforeunload",o),r.stopPolling(),r.disconnectWebSocket()});const s=()=>{document.hidden?(r.stopPolling(),console.log("页面隐藏，停止轮询")):t.isAuthenticated&&r.hasProcessingTasks&&(r.startPolling(5e3),console.log("页面显示，重新开始轮询"))},o=a=>{if(r.getProcessingTasks.length>0){const i="您有正在进行的下载任务，确定要离开吗？";return a.returnValue=i,i}};return(a,n)=>{const i=H("router-view");return D(),M("div",ke,[R(i,null,{default:V(({Component:h})=>[R(J,{name:"page",mode:"out-in"},{default:V(()=>[(D(),Q(K(h)))]),_:2},1024)]),_:1})])}}},Te="modulepreload",Ee=function(e){return"/download-center/"+e},U={},k=function(t,r,s){let o=Promise.resolve();if(r&&r.length>0){let n=function(l){return Promise.all(l.map(u=>Promise.resolve(u).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),h=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));o=n(r.map(l=>{if(l=Ee(l),l in U)return;U[l]=!0;const u=l.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${l}"]${f}`))return;const g=document.createElement("link");if(g.rel=u?"stylesheet":Te,u||(g.as="script"),g.crossOrigin="",g.href=l,h&&g.setAttribute("nonce",h),document.head.appendChild(g),u)return new Promise((B,G)=>{g.addEventListener("load",B),g.addEventListener("error",()=>G(new Error(`Unable to preload CSS for ${l}`)))})}))}function a(n){const i=new Event("vite:preloadError",{cancelable:!0});if(i.payload=n,window.dispatchEvent(i),!i.defaultPrevented)throw n}return o.then(n=>{for(const i of n||[])i.status==="rejected"&&a(i.reason);return t().catch(a)})},_e=()=>k(()=>import("./DownloadCenter-GHNYxD0z.js"),__vite__mapDeps([0,1,2,3,4,5])),ye=()=>k(()=>import("./DownloadTaskList-BLUuaHTE.js"),__vite__mapDeps([6,1,7,2,3,4,8])),Pe=()=>k(()=>import("./DownloadTaskCreate-BoeZmmfC.js"),__vite__mapDeps([9,1,2,3,4,10])),ve=()=>k(()=>import("./DownloadTaskDetail-DOhBgmyJ.js"),__vite__mapDeps([11,1,7,2,3,4,12])),F=()=>k(()=>import("./DownloadFailures-BQPOndkM.js"),__vite__mapDeps([13,1,7,2,3,4,14])),x=()=>k(()=>import("./DownloadVideosDetail-DyRP_xv1.js"),__vite__mapDeps([15,1,7,2,3,4,16])),Ae=()=>k(()=>import("./AuthCallback-wgzNuSBI.js"),__vite__mapDeps([17,1,3,2,4,18])),be=["/download-center","/download-center/tasks","/download-center/tasks/create","/download-center/tasks/:taskId","/download-center/tasks/:taskId/failures","/download-center/tasks/:taskId/videos","/download-center/failures","/download-center/videos"];function Le(e){return be.some(t=>{const r=t.replace(":taskId","[^/]+");return new RegExp(`^${r}(/.*)?$`).test(e)})}const Ie=[{path:"/",redirect:"/download-center"},{path:"/auth/callback",name:"AuthCallback",component:Ae,meta:{title:"登录处理中",requiresAuth:!1}},{path:"/download-center",name:"DownloadCenter",component:_e,meta:{title:"下载中心",requiresAuth:!0},children:[{path:"",redirect:"/download-center/tasks"},{path:"tasks",name:"DownloadTaskList",component:ye,meta:{title:"下载任务列表",requiresAuth:!0}},{path:"tasks/create",name:"DownloadTaskCreate",component:Pe,meta:{title:"创建下载任务",requiresAuth:!0}},{path:"tasks/:taskId",name:"DownloadTaskDetail",component:ve,props:!0,meta:{title:"任务详情",requiresAuth:!0}},{path:"tasks/:taskId/failures",name:"DownloadFailures",component:F,props:!0,meta:{title:"下载失败记录",requiresAuth:!0}},{path:"tasks/:taskId/videos",name:"DownloadVideosDetail",component:x,props:!0,meta:{title:"已下载视频",requiresAuth:!0}},{path:"failures",name:"DownloadFailuresGlobal",component:F,meta:{title:"下载失败记录",requiresAuth:!0}},{path:"videos",name:"DownloadVideosGlobal",component:x,meta:{title:"已下载视频",requiresAuth:!0}}]},{path:"/:pathMatch(.*)*",name:"NotFound",component:()=>k(()=>import("./NotFound-BzQxAsOC.js"),__vite__mapDeps([19,1,3,20])),meta:{title:"页面未找到"}}],L=X({history:Y("/download-center/"),routes:Ie,scrollBehavior(e,t,r){return r||{top:0}}});L.beforeEach(async(e,t,r)=>{var o,a;if(console.log(`路由导航: ${t.path} -> ${e.path}`),(o=e.meta)!=null&&o.title&&(document.title=`${e.meta.title} - 媒体下载服务`),((a=e.meta)==null?void 0:a.requiresAuth)||Le(e.path)){const n=P();console.log("检查认证状态...");const i=localStorage.getItem("jwt_token");if(!i){console.log("未找到Token，跳转登录"),n.setRedirectPath(e.fullPath),localStorage.setItem("auth_redirect_path",e.fullPath);const h=window.location.origin.replace("http://","").replace("https://",""),l=S.replace(/\/$/,""),u=`${h}${l}`,f=`${_}?external_callback=true&origin=${u}`;console.log("跳转登录，原始路径:",e.fullPath),console.log("回调域名（含路径）:",u),window.location.href=f;return}if(!m(i)){console.log("Token已过期，跳转登录"),n.clearAuth(),n.setRedirectPath(e.fullPath),localStorage.setItem("auth_redirect_path",e.fullPath);const h=window.location.origin.replace("http://","").replace("https://",""),l=S.replace(/\/$/,""),u=`${h}${l}`,f=`${_}?external_callback=true&origin=${u}`;console.log("Token过期，跳转登录，原始路径:",e.fullPath),console.log("回调域名（含路径）:",u),window.location.href=f;return}if(!n.isAuthenticated&&(console.log("恢复认证状态..."),!n.setToken(i))){console.error("恢复认证状态失败"),n.forceReauth(e.fullPath);return}console.log("认证检查通过"),n.isAuthenticated=!0}r()});L.afterEach((e,t)=>{console.log(`路由导航完成: ${e.path}`)});L.onError(e=>{console.error("路由错误:",e),e.message.includes("Loading chunk")&&window.location.reload()});const T=Z(me),Se=ee();T.use(Se);T.use(L);T.use(re);for(const[e,t]of Object.entries(oe))T.component(e,t);T.config.errorHandler=(e,t,r)=>{console.error("全局错误:",e),console.error("错误信息:",r),console.error("组件实例:",t)};async function $e(){try{console.log("正在初始化应用..."),await P().initializeAuth(),console.log("应用初始化完成"),T.mount("#app"),console.log("应用启动成功")}catch(e){console.error("应用初始化失败:",e),P().clearAuth(),T.mount("#app")}}$e();export{Oe as F,ge as a,P as u};

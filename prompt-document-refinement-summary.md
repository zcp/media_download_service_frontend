# 提示词文档优化总结

## 🎯 **优化目标**

将提示词文档中过多的具体代码实现转换为**功能规范、实现要求和设计标准**，使其更适合指导AI生成代码，而不是直接包含完整的代码实现。

## ✅ **已完成的优化**

### **1. 用户模块前端文档（uni-app）优化**

#### 优化前问题：
- ❌ 包含200+行具体的TypeScript/Vue代码实现
- ❌ 详细的函数实现逻辑和完整样式代码
- ❌ 过于具体的代码示例，不适合作为提示词

#### 优化后改进：
- ✅ **功能描述导向**：明确说明需要实现什么功能
- ✅ **实现要求规范**：列出具体的技术要求和约束条件
- ✅ **设计规范标准**：提供UI/UX设计的标准和规范
- ✅ **API接口规范**：明确函数签名和核心逻辑要求

#### 具体优化内容：

**第327-402行 重构为：**
```markdown
## 4. 跨服务SSO集成实现规范

### 4.1. 外部应用登录检测要求
**功能描述：** 在 `pages/auth/login.vue` 页面中实现外部应用回调检测机制

#### 4.1.1. URL参数检测逻辑
**实现要求：**
- 必须检测URL参数：`external_callback` (布尔值) 和 `origin` (域名)
- 当 `external_callback=true` 且 `origin` 有值时，判定为外部应用登录请求
- 设置响应式变量 `isExternalLogin` 用于控制UI显示
- 在页面 `onMounted` 钩子中执行检测逻辑
- 检测到外部登录时，显示Toast提示："来自外部应用的登录请求"
```

**关键改进点：**
- 🔄 **从具体代码** → **功能要求描述**
- 🔄 **从完整实现** → **核心逻辑规范**
- 🔄 **从代码示例** → **设计标准**

### **2. 媒体下载服务前端文档（Vue 3）优化**

#### 优化前问题：
- ❌ 包含260+行完整的HTML/CSS/JavaScript代码
- ❌ 详细的Vue组件完整实现代码
- ❌ 过度具体的样式和脚本实现

#### 优化后改进：
- ✅ **页面设计规范**：明确页面功能和技术要求
- ✅ **组件设计标准**：规范组件的功能、UI、集成要求
- ✅ **实现约束条件**：明确技术选型和实现限制

#### 具体优化内容：

**第382-433行 重构为：**
```markdown
## 三、跨服务认证集成规范

### 3.1 外部登录回调页面设计规范
#### simple-callback.html 页面要求
**文件位置：** `public/simple-callback.html`
**功能描述：** 处理来自用户服务的登录回调，作为跨域认证的中间页面

**核心功能要求：**
- URL参数解析：提取 `token`、`error`、`error_description` 等参数
- Token验证：基础的JWT格式验证（检查是否为3段式结构）
- 状态反馈：显示处理状态（处理中、验证中、成功、失败）
- 自动跳转：验证成功后跳转到 `/auth/callback?token=xxx`
- 错误处理：失败时显示错误信息，3秒后跳转到首页
```

**关键改进点：**
- 🔄 **从完整页面代码** → **页面功能规范**
- 🔄 **从具体组件实现** → **组件设计要求**
- 🔄 **从详细样式代码** → **UI设计标准**

## 📊 **优化效果对比**

### **优化前（不合适的提示词）：**
```typescript
// ❌ 包含具体实现代码
function handleExternalCallback(token: string, userInfo: any = null): boolean {
  const urlParams = getUrlParams()
  
  if (!urlParams.external_callback || !urlParams.origin) {
    return false // 不是外部回调请求
  }
  
  // 安全检查：验证域名是否在白名单中
  import('@/constants/api').then(({ ALLOWED_ORIGINS }) => {
    if (!ALLOWED_ORIGINS.includes(urlParams.origin)) {
      console.error('❌ 不允许的来源域名:', urlParams.origin)
      // ... 更多具体实现代码
    }
  })
}
```

### **优化后（合适的提示词）：**
```markdown
#### 4.1.3. 外部回调处理函数设计
**函数签名：** `handleExternalCallback(token: string, userInfo?: any): boolean`
**核心逻辑：**
- 检查是否为外部回调请求（根据URL参数）
- 域名白名单验证：使用 `ALLOWED_ORIGINS` 常量验证 `origin` 参数
- 构建回调URL：`${protocol}://${origin}/simple-callback.html?token=${token}`
- 协议判断：localhost/127.0.0.1 使用 http，其他使用 https
- 跳转前显示"登录成功，正在跳转..."提示，延迟1秒执行跳转
- 返回布尔值表示是否处理了外部回调
```

## 🎯 **优化原则**

### **1. 从实现转向规范**
- ❌ 不提供：具体的代码实现
- ✅ 提供：功能规范和实现要求

### **2. 从细节转向标准**
- ❌ 不提供：详细的样式代码
- ✅ 提供：设计标准和UI规范

### **3. 从示例转向指导**
- ❌ 不提供：完整的代码示例
- ✅ 提供：API设计和集成指导

### **4. 保留关键约束**
- ✅ 保留：参数命名、函数签名、配置项
- ✅ 保留：安全要求、错误处理规范
- ✅ 保留：技术选型和架构约束

## 📋 **文档结构优化**

### **优化后的文档特点：**

1. **功能导向**：先说明要实现什么功能
2. **要求明确**：列出具体的技术要求和约束
3. **标准清晰**：提供设计和实现标准
4. **规范完整**：覆盖所有必要的实现细节
5. **指导性强**：便于AI理解和生成代码

### **提示词文档的核心价值：**

- 🎯 **指导AI理解需求**：明确说明要实现什么
- 🎯 **约束AI实现方式**：规范如何实现
- 🎯 **保证实现质量**：提供标准和规范
- 🎯 **确保架构一致**：统一技术选型和设计

## ✅ **最终成果**

现在两个文档都已优化为**合适的提示词文档**：

- ✅ **用户模块文档**：75行规范化描述（原200+行代码）
- ✅ **媒体服务文档**：50行设计要求（原260+行代码）
- ✅ **保持了所有核心功能要求和技术约束**
- ✅ **更适合指导AI生成高质量的代码实现**

这样的提示词文档能够：
1. **指导AI生成符合要求的代码**
2. **保证跨服务SSO功能的完整实现**
3. **维持代码架构的一致性和质量**
4. **便于后续维护和功能扩展**
